---

# **전투 로직 및 전투 데이터 처리**

## 

## **1\. AutoAttack 클래스**

### **1.1. 개요 및 구조**

AutoAttack은 공격을 자동화 해주는 클래스로서 1개의 기본 공격 스킬(캐릭터 종속) 4개의 선택지 장비에 따라 변경함.

### **1.2. 실행 로직**

#### **A.** 장비 추가 (Step 1: Add Weapon)

* **동작 시점:** 장비를 획득 시(장비 개수가 최대치에 도달했을 때 장비 선택지는 등장하지 않음)  
* **동작 로직:**   
  장비 초기 설정 시작 → Weapon 배열에 추가→ AttackLogic 코루틴 동작 시작 → Cooldown(초기 설정 딜레이 값에 따른 재사용 대기 시간) → Attack 반복.  
* **딜레이 처리**: Weapon 스크립트에 AttackDelay(float)값으로 딜레이를 가지고 있음, 전역 증강, 쿨타임 감소 스탯에 따라서 조절됨.

## **2\. Weapon 클래스**

### **2.1. Weapon 추상 클래스**

Weapon 클래스를 상속 받은 AoE, Projectile Weapon 클래스로 범위 공격 무기와 투사체 공격 무기를 구현

### **2.2. Weapon 키워드**

#### **A.** 재정의 요소 

* **초기 설정:** WeaponSettingLogic를 자식에서 재정의  
* **공격 로직:** AttackLogic을 자식에서 재정의

### **2.3. AoEWeapon**

#### **A.** 동작

* **OnTriggerEnter:** 범위 안에 들어오는 몬스터를 EnemysInRange List에 추가  
* **OnTriggerExit:** 범위 밖으로 나가는 몬스터를 EnemysInRange List에서 제거  
* **AttackLogic:** 주기적으로 List안의 몬스터에게 피해를 입힘

#### **B. 주의 요소**

※몬스터 스폰이 범위 안에서 스폰되는 상황에 대해 생각해 볼 필요 있을것 같음

1. 지형 아래에서 생성해서, 위로 올리기  
2. 스폰 범위를 플레이어와 멀리 두기  
   1. 플레이어의 효과 범위가 늘어났을 때 플레이어의 “안전 지대”가 넓어지는 효과가 생길 수 있어서 1안으로 작업해볼 예정

### **2.4. ProjectileWeapon**

#### **A.** ProjectileWeapon \+ Projectile

* **ProjectileWeapon:** Object Pooling을 위한 클래스 WeaponSettingLogic에서 생성 되고, PooledProjectiles리스트에 추가  
* **GetProjectile:** PooledProjectiles에서 비활성화 되어있는 Projectile을 가져옴  
* **SetProjectile:** GetProjectile에서 가져온 Projectile을 재사용하기 위한 설정을 진행 Target, 발사 위치 등을 지정함  
* **FindTarget:** 공격 범위 안에서 콜라이더를 찾아와서 가장 가까운 적을 찾음

#### **B. 주의 요소**

※가장 가까운 적을 찾는다?

1. OverlapSphere를 통해 감지된 모든 콜라이더를 순회해 가까운 적을 찾음  
2. 작은 원에서 시작해서 감지가 안됐을 시 반지름을 키워서 다시 감지?

## **3\. BattleManager 클래스**

### **3.1. 개요 및 구조**

DamageEventStruct를 기반으로 공격자의 공격을 피격자에게 전달함  
데미지 총량을 각 무기에 저장 Event처리하면서 동시에 진행

### **3.2. DamageEventStruct**

#### **A.** 변수

* **총 데미지:** damageAmount  
* **공격자 무기:** senderWeapon  
* **공격자:** sender  
* **피격자:** receiver

#### **B.** 데미지 통계

Event처리 과정에서 데미지를 저장해 총량을 결과창에서 보여줌

#### **C.** 특수 효과

조건부 특수 효과를 새로운 EvnetStruct로 정의해서 사용할 예정

* 명시된 공격자 무기에 따른 특수 효과(있다면)를 발생시키는 기능  
* 피격자의 사망/피격에 따른 특수 효과(있다면)를 발생시키는 기능

---

