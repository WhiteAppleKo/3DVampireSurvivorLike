# 📅 2026-01-12 일일 작업 일지

## 📝 오늘 한 일

### 1. 스테이지 시스템(StageManager) 구현
- `SingletoneBase`를 상속받은 `StageManager` 클래스 생성.
- **5분 단위 스테이지 로직**: `IMTimer`를 감시하여 5분 경과 시 스테이지 클리어, 타이머 초기화, 스테이지 레벨 증가 로직 구현.
- `StageDataBase`와 연동하여 현재 스테이지에 맞는 정보를 가져오는 `GetStageInformation` 메서드 구현.

### 2. CSV 데이터 임포터(StageImporter) 고도화 및 버그 수정
- **따옴표 파싱 문제 해결**: CSV 데이터에 포함된 큰따옴표(`"`)를 제거하는 로직 추가 (`Replace("\"", "")`).
- **구분자 변경**: 열 구분자를 콤마(`,`)에서 세미콜론(`;`)으로 변경하여, 몬스터 리스트 내부의 콤마와 충돌하지 않도록 유연성 확보.
- **데이터 로드 방식 변경**: `Resources.LoadAll` 대신 `MonsterDatabase` 에셋을 직접 로드하도록 수정하여 경로 문제 및 로드 실패 해결.

### 3. 저장 시스템(Saving System) 상세 분석 및 설계
- **데이터 분석**: `PlayerStats`, `BaseStats`, `StatAbility`, `WeaponAbility` 스크립트를 정밀 분석하여 저장해야 할 핵심 데이터를 식별함.
    - 플레이어: 레벨, 경험치, HP(현재/최대), 이동 속도, 증강 레벨.
    - 무기: 각 무기별 데미지 배율, 공격 속도 등 증강으로 변화된 최종 상태.
- **저장 방식 비교 및 결정**:
    1. **값 저장 방식 (채택)**: 현재 적용된 최종 스탯 수치(예: 데미지 15)를 그대로 저장. 로드 시 별도 계산 없이 즉시 적용 가능하여 안정성이 높음.
    2. **ID 재계산 방식 (기각)**: 획득한 증강 ID만 저장하고 로드 시 다시 `Apply()` 하는 방식. 로직이 복잡하고 초기화 순서 이슈 발생 가능성 있음.
- **최종 설계 (JSON 직렬화)**: `GameSaveData` 클래스를 정의하고 `JsonUtility`를 사용하는 방식으로 결정.
    - `currentStage`, `playTime` 등 게임 진행 정보.
    - `playerLevel`, `currentExp`, `currentHp` 등 플레이어 상태.
    - `List<WeaponSaveData>`를 통해 각 무기별 상태(ID, 레벨, 변동된 스탯)를 개별 관리.
    - `acquiredAugmentIDs` 리스트도 함께 저장하여 UI 표시 및 디버깅 용이성 확보.

---

## 💡 작업 과정에서 새롭게 배운 점
- CSV 파싱 시 데이터 내부에 리스트가 포함될 경우, 전체 열 구분자(Delimiter)를 `;`와 같이 콤마가 아닌 문자로 설정하는 것이 데이터 무결성 유지에 훨씬 유리하다는 점을 확인했습니다.
- 무기 스탯의 경우 `BaseStats`와 별도로 관리되므로, 저장 시에도 `WeaponSaveData`와 같이 별도의 클래스로 구조화하여 저장해야 함을 설계 과정에서 파악했습니다.

---

## ⚠️ 작업 과정에서 직면했던 문제점
- **초기화 순서 문제**: `StageManager`가 `Start`에서 `SpawnManager`를 호출할 때, `SpawnManager` 내부 변수가 아직 초기화되지 않아 `NullReferenceException`이 발생했습니다. (초기화 로직을 `Awake`로 옮겨 해결 권장)
- **따옴표 중첩 문제**: 엑셀에서 저장된 CSV의 특성상 따옴표가 `"""`와 같이 중첩되어 들어오는 현상이 발생하여, 정규식 또는 문자열 치환을 통한 정제 과정이 필수적이었습니다.

---

## 🚀 내일의 목표
- 설계된 `GameSaveData` 클래스 및 `SaveManager` 실제 코드 구현.
- `StageManager`의 자동 저장(`AutoSave`) 호출 시점에 실제 JSON 파일 생성 테스트.
- 게임 재시작 시 저장된 스탯과 무기 상태가 정상적으로 로드되어 적용되는지 검증.